# 物理题目图片转 2D/3D 模拟场景应用 - 项目开发计划书

## 1. 项目概述
本项目旨在开发一款能够将物理题目图片智能转化为交互式 2D/3D 物理模拟场景的应用程序。通过集成 OCR、大语言模型和物理引擎，实现从静态题目到动态模拟的转换，辅助物理教学与解题验证。

## 2. 系统架构设计

### 2.1 前端模块 (Frontend)
*   **技术栈**: React, Konva.js (2D), Three.js (3D扩展)
*   **功能模块**:
    *   **图片上传界面**: 支持拖拽上传，兼容 JPG/PNG 格式，提供图片预览与裁剪功能。
    *   **2D 物理场景可视化引擎**: 基于 Canvas/WebGL (Konva.js)，实现刚体、连接件、力的可视化渲染。
    *   **交互式参数控制面板**:
        *   **已知量**: 自动填充识别数值，支持手动修正。
        *   **未知量/变量**: 提供滑块或输入框，支持动态调整以观察对模拟结果的影响。

### 2.2 后端服务 (Backend)
*   **技术栈**: Python, FastAPI
*   **微服务架构**:
    *   **大模型与图像理解服务**: 统一由多模态 LLM 处理，负责从图片中提取物理实体、关系及数值，并生成标准化的场景参数。
    *   **物理引擎计算核心**:
        *   **正向模拟**: 给定初始条件推演结果。
        *   **逆向模拟**: 根据结果反推初始条件（需求解器支持）。

### 2.3 可视化场景编辑器 (Visual Editor) 开发蓝图
*   **设计理念**: "从地基到机械" (Ground Up). 先构建静态环境，再放置刚体，最后建立连接。
*   **阶段规划**:
    1.  **阶段一：环境与地基 (Environment & Foundation)**
        *   **功能**: 画布网格 (Grid)、标尺 (Ruler)、视图平移/缩放。
        *   **核心组件**: 地面 (Ground)、墙壁 (Walls)、固定斜面 (Fixed Ramp)。
        *   **交互**: 智能吸附 (Snap to Grid)，确保地形对齐。
    2.  **阶段二：刚体与物体 (Rigid Bodies)**
        *   **组件**: 自由滑块 (Block)、小球 (Ball)、多边形。
        *   **属性**: 质量、摩擦系数、弹性系数、初速度。
        *   **交互**: 拖拽生成、调整尺寸 (Resize)、旋转 (Rotate)。
    3.  **阶段三：连接与约束 (Connections)**
        *   **组件**: 理想绳索 (Ideal Rope)、弹簧 (Spring)、刚性杆 (Rod)、滑轮 (Pulley)。
        *   **交互**: "点对点" 连接模式 (Click A -> Click B)。
    4.  **阶段四：动力机械 (Mechanisms)**
        *   **组件**: 传送带 (Conveyor)、马达 (Motor)、推力器 (Thruster)。
        *   **参数**: 速度、扭矩、力的大小。
    5.  **阶段五：分析与调试 (Analysis)**
        *   **可视化**: 速度矢量显示、受力分析图、轨迹追踪。
        *   **控制**: 慢动作回放、单帧步进。

### 2.4 技术架构 (Technical Architecture)

## 3. 核心功能实现流程

### 3.1 图像理解与参数提取 (LLM 核心)
*   **策略**: 摒弃传统的 OCR 流水线，直接利用多模态 LLM (如 GPT-4V/Claude 3.5 Sonnet) 的视觉理解能力。
*   **流程**:
    1.  **图像输入**: 上传原始物理题目图片。
    2.  **视觉解析 Prompt**: 指导 LLM 识别图中的关键物理实体（滑块、斜面、滑轮、绳索、弹簧等）、几何关系（角度、距离）及文本数值条件。
    3.  **物理建模抽象**: 要求 LLM 将视觉信息抽象为物理模型（例如：“图中有一个质量为 m 的滑块在倾角为 theta 的粗糙斜面上”）。

### 3.2 参数生成与校验 (Prompt Engineering 重点)
*   **目标**: 保证生成的参数文本能精准对应物理引擎的场景描述。
*   **关键技术**:
    *   **Schema 约束**: 定义严格的 JSON Schema，规定各类物体（Body）、约束（Constraint）、力（Force）的数据结构。
    *   **物理感知 Prompt (Physics-Informed Prompting)**:
        *   **思维链 (CoT)**: 让 LLM 先用自然语言描述物理过程，再转换为 JSON，减少逻辑错误。
        *   **隐含条件显式化**: 提示 LLM 挖掘“光滑”（摩擦系数=0）、“轻绳”（质量=0）、“静止释放”（初速度=0）等隐含参数。
    *   **自洽性校验**: 后端对生成的 JSON 进行物理合理性检查（如：绳长是否足够连接两物体，物体是否重叠）。

### 3.3 物理模拟引擎深化 (Matter.js 高级应用)
*   **目标**: 覆盖 99% 常见力学场景，重点突破复杂连接体。
*   **核心场景实现方案**:
    *   **基础运动**: 抛体、圆周运动、斜面滑行（通过摩擦力与重力分量实现）。
    *   **滑轮组 (Pulleys)**: 利用 Matter.js 的 `Constraint` (约束) 系统，通过刚性约束模拟定滑轮，通过动态长度约束模拟动滑轮。
    *   **绳索系统 (Ropes)**: 使用多个小矩形刚体通过 `Constraint` 串联（链式结构），模拟绳索的柔性与张力。
    *   **传送带**: 创建具有恒定表面速度的静态刚体，或在接触区域持续施加摩擦力。
    *   **牛顿摆**: 精确调整高恢复系数（Restitution）的弹性碰撞模型。
    *   **刚体碰撞**: 基于 SAT (分离轴定理) 的高精度碰撞检测。

## 4. 特殊功能开发

### 4.1 未知量处理
*   **可视化标识**: 使用**红色**高亮未知量，**蓝色**标记已知量。
*   **参数拟合**: 针对待求参数，允许用户设定目标结果，系统通过最小二乘法或梯度下降自动寻找最优参数解。
*   **结果对比视图**: 支持“分屏对比”或“重叠对比”，同时展示不同参数下的模拟轨迹。

### 4.2 扩展性设计
*   **3D 接口预留**: 数据结构设计时增加 `z` 轴与 `quaternion` (四元数) 字段，为 Cannon.js/Three.js 接入做准备。
*   **题型分类器**: 基于 NLP 对题目文本分类（牛顿定律、动能定理、动量守恒等），自动匹配预设场景模板。

## 5. 开发里程碑规划

| 阶段 | 周期 | 核心目标 | 详细任务 |
| :--- | :--- | :--- | :--- |
| **阶段 1** | 第 1-2 周 | **MVP 原型** | 1. 搭建前后端基础框架 (React + FastAPI)。<br>2. 接入多模态 LLM，验证图片转文字描述的可行性。<br>3. 实现简单滑块/斜面模型的 2D 静态渲染。 |
| **阶段 2** | 第 3-4 周 | **核心功能** | 1. 深度开发 Prompt，跑通“图片 -> 物理感知 JSON”流水线。<br>2. 集成 Matter.js，实现基础运动模拟。<br>3. 开发参数控制面板，实现参数与场景的双向绑定。 |
| **阶段 3** | 第 5-6 周 | **进阶功能** | 1. **攻克复杂场景**: 实现滑轮组、绳索、传送带等高级约束系统。<br>2. 实现未知量拟合算法。<br>3. 性能优化 (Web Worker 物理计算)。 |
| **阶段 4** | 第 7-8 周 | **3D 扩展** | 1. 3D 渲染框架搭建 (Three.js)。<br>2. 场景数据 2D 转 3D 映射逻辑。<br>3. 跨平台兼容性测试与 Bug 修复。 |

## 6. 质量保障措施

*   **测试策略**:
    *   建立包含 10 类经典物理题型（斜面滑块、传送带、平抛、圆周运动、碰撞等）的标准测试集。
    *   **LLM 评估**: 构建“黄金标准”数据集，评估 LLM 提取物理参数的准确率（目标 > 90%）。
    *   对大模型生成的参数进行边界条件压力测试（如质量为 0、摩擦系数 > 1 等异常处理）。
*   **性能指标**:
    *   参数生成总耗时 < 5秒 (取决于 LLM API 响应)。
    *   模拟场景加载时间 < 1秒。
    *   前端渲染帧率稳定在 60FPS。
*   **文档交付**: API 接口文档 (Swagger/Redoc)、用户操作手册、物理参数 JSON 规范说明书。

## 7. 技术选型建议

*   **前端**: React + Konva.js (2D) / Three.js (3D) + TailwindCSS
*   **后端**: Python 3.10+ + FastAPI
*   **AI/LLM**: GPT-4V / Claude 3.5 Sonnet / Gemini Pro Vision (多模态视觉理解)
*   **物理引擎**: Matter.js (2D 模拟, 需深度定制 Constraints) / Cannon.js (3D 模拟)
*   **数据存储**: SQLite (轻量级) 或 PostgreSQL (生产环境)
